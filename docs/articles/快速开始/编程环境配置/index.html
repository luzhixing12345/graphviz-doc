<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel='stylesheet' href=../../../css/prism.css /><link rel='stylesheet' href=../../../css/index.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">

</head>
<body class="light">
    <div class='markdown-body'><h1>编程环境配置</h1><p>考虑到作为文档的完整性,这里详细讲解一下python和C的graphviz环境搭建</p><h2>DOT</h2><p>你可以在bin/目录下(/usr/bin/dot)直接运行dot程序,如果你使用的编程语言暂时不支持调用graphviz库,那么可以先输出一个.dot文件,然后再使用类似os.system或者execve开启一个操作系统进程去调用dot解析相关文件,得到最后的结果</p><h2>Python</h2><p>python已有graphviz的python接口库及<a href="https://graphviz.readthedocs.io/en/stable/manual.html" target="_blank">文档</a></p><pre><code class="language-bash">pip install graphviz</code></pre><h2>C</h2><p>新建文件test.c</p><pre><code class="language-c">#include &lt;graphviz/gvc.h&gt;

char buf[1024];

void readFile(char *fname)
{
    FILE *fp = fopen(fname, "r");
    int p = 0;
    char ch;
    while ((ch = fgetc(fp)) != EOF)
    {
        buf[p++] = ch;
    }
    buf[p] = '\0';
}

int main(int argc, char **argv)
{
    GVC_t *gvc;
    Agraph_t *g;
    gvc = gvContext();
    readFile("ast.dot");
    g = agmemread(buf);
    gvLayout(gvc, g, "dot");
    gvRenderFilename(gvc, g, "png", "out.png");
    gvFreeLayout(gvc, g);
    agclose(g);
    return (gvFreeContext(gvc));
}
</code></pre><p>新建文件ast.dot</p><pre><code class="language-txt">digraph astgraph {
  node [shape=circle, fontsize=12, fontname="Courier", height=.1];
  ranksep=.3;
  edge [arrowsize=.5]
  node1 [label="+"]
  node2 [label="7"]
  node3 [label="*"]
  node4 [label="3"]
  node5 [label="/"]
  node6 [label="10"]
  node7 [label="-"]
  node8 [label="/"]
  node9 [label="12"]
  node10 [label="+"]
  node11 [label="3"]
  node12 [label="1"]
  node10 -&gt; node11
  node10 -&gt; node12
  node8 -&gt; node9
  node8 -&gt; node10
  node13 [label="1"]
  node7 -&gt; node8
  node7 -&gt; node13
  node5 -&gt; node6
  node5 -&gt; node7
  node3 -&gt; node4
  node3 -&gt; node5
  node1 -&gt; node2
  node1 -&gt; node3
}</code></pre><h3>Windows</h3><blockquote>假设graphviz的安装目录为 D:\graphviz, 使用的是vscode(如果是vs或clion应该是有能力解决这个问题的)</blockquote><p>如果是使用C/C++ Extension Pack,点击include报错添加include<i>path,则会出现一个.vscode/c</i>cpp_properties.json,将graphviz的include目录加入includePath即可</p><p>注意windows下路径分隔使用 <code>\\</code> 或 <code>/</code></p><pre><code class="language-json">{
    "configurations": [
        {
            "name": "Win32",
            "includePath": [
                "${workspaceFolder}/**",
                "D:\\graphviz\\include"
            ],
            "defines": [
                "_DEBUG",
                "UNICODE",
                "_UNICODE"
            ],
            "compilerPath": "D:\\mingw64\\bin\\gcc.exe",
            "cStandard": "gnu17",
            "cppStandard": "gnu++14",
            "intelliSenseMode": "windows-gcc-x64"
        }
    ],
    "version": 4
}</code></pre><p>如果是使用的clangd,新建<code>.vscode/settings.json</code>,fallbackFlags中加入include路径即可,后面的clangd.arguments是笔者比较喜欢的clangd配置信息,可加可不加.重启vscode后可以找到头文件和代码补全了</p><pre><code class="language-json">{
    "clangd.fallbackFlags": [
        "-ID:\\graphviz\\include",
    ],
    "clangd.arguments": [
        "--background-index", // 在后台自动分析文件（基于complie_commands)
        "-j=12",  // 同时开启的任务数量
        "--clang-tidy", // clang-tidy功能
        "--clang-tidy-checks=performance-*,bugprone-*",
        "--all-scopes-completion", // 全局补全（会自动补充头文件）
        "--completion-style=detailed", // 更详细的补全内容
        "--header-insertion=iwyu" // 补充头文件的形式
    ]
}</code></pre><p>点击vscode上方 终端->配置任务,然后通过gcc创建 <code>.vscode/task.json</code></p><p>在task.json中修改编译选项</p><pre><code class="language-json">"args": [
    "-fdiagnostics-color=always",
    "-g",
    "${file}",
    "-o",
    "${fileDirname}\\${fileBasenameNoExtension}.exe",
    "-ID:\\graphviz\\include",
    "-LD:\\graphviz\\lib",
    "-lgvc",
    "-lcgraph",
    "-lcdt"
],</code></pre><p>这里声明头文件路径<code>D:\\graphviz\\include</code>,静态链接库的路径<code>D:\\graphviz\\lib</code>,以及三个静态链接库的名字</p><p>编译运行后即可得到<code>output.png</code></p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/out.png" alt="out"></p><blockquote>Windows下使用agread可能会造成segment fault</blockquote><h3>GNU/Linux</h3><blockquote>假设使用Ubuntu/Debian系,其他系基本类似</blockquote><p>下载开发版本和包管理pkg-config</p><pre><code class="language-bash">sudo apt install pkg-config graphviz-dev</code></pre><p>此时graphviz头文件的位置为 <code>/usr/include/graphviz</code></p><p>如果是C++ Extension Pack那么已经可以找到graphviz的头文件和代码补全了</p><p>如果是clangd的话类似的加入头文件路径,重启vscode生效</p><pre><code class="language-json">{
    "clangd.fallbackFlags": [
        "-I/usr/include/graphviz",
    ],
    "clangd.arguments": [
        "--background-index", // 在后台自动分析文件（基于complie_commands)
        "-j=12",  // 同时开启的任务数量
        "--clang-tidy", // clang-tidy功能
        "--clang-tidy-checks=performance-*,bugprone-*",
        "--all-scopes-completion", // 全局补全（会自动补充头文件）
        "--completion-style=detailed", // 更详细的补全内容
        "--header-insertion=iwyu" // 补充头文件的形式
    ]
}</code></pre><p>点击vscode上方 终端->配置任务,然后通过gcc创建 <code>.vscode/task.json</code></p><p>在task.json中修改编译选项,这里就不需要指定静态库的位置了.</p><blockquote>除此之外你可以在 <code>/lib/x86_64-linux-gnu/graphviz</code> 下找到其他动态链接库的</blockquote><pre><code class="language-json">"args": [
    "-fdiagnostics-color=always",
    "-g",
    "${file}",
    "-o",
    "${fileDirname}/${fileBasenameNoExtension}",
    "-I/usr/include/graphviz",
    "-lgvc",
    "-lcgraph",
    "-lcdt"
],</code></pre><p>编译运行后即可得到<code>output.png</code></p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/out.png" alt="out"></p><p>如果使用Makefile的话,可以直接借助pkg-config查找相关信息,异曲同工此处便不再赘述</p><pre><code class="language-Makefile">CFLAGS=`pkg-config libgvc --cflags` -Wall -g -O2
# -I/usr/include/graphviz

LDFLAGS=`pkg-config libgvc --libs`
# -lgvc -lcgraph -lcdt

main: main.c
    $(CC) $^ $(CFLAGS) $(LDFLAGS) -o $@</code></pre></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../快速开始/下载" >快速开始<ul><li><a href="../../快速开始/下载" >下载</a></li></ul><ul><li><a href="../../快速开始/编程环境配置" >编程环境配置</a></li></ul><ul><li><a href="../../快速开始/DOT入门尝试" >DOT入门尝试</a></li></ul></a></li></ul><ul><li><a href="../../DOT/背景" >DOT<ul><li><a href="../../DOT/背景" >背景</a></li></ul></a></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank" >zood</a></div>
    <script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/prism.js"></script><script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../快速开始/下载","../../快速开始/DOT入门尝试","ab")</script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/search.js"></script><script>addSearchBar("{\"../../DOT/\u80cc\u666f\": \"\u80cc\u666fXdot\u5982\u4e0b\u7684\u65b9\u5f0f\u53ef\u4ee5\u5728\u80cc\u666f\u4e2d\u751f\u6210\u4e00\u4e2a\u7ea2\u8272\u7684\u6b63\u65b9\u5f62digraph G {  _background=c 7 -#ff0000 p 4 4 4 36 4 36 36 4 36;  a -&gt; b  a -&gt; c  a -&gt; d}\u5176\u4e2d\u63a7\u5236_background\u7684\u5c5e\u6027\u7684\u5c31\u662fXdot\u8282\u70b9: c 7 -#ff0000 p 4 4 4 36 4 36 36 4 36Xdot\u7684\u53c2\u6570\u5927\u6982\u5206\u4e3a\u5982\u4e0b\u51e0\u79cd\u5176\u4e2d\u5f00\u5934\u7684\u5b57\u6bcd\u4e3a\u7f29\u5199,\u4ee5\u53ca\u5bf9\u5e94\u7684\u6807\u8bc6\u7b26.n\u4e3a\u70b9\u7684\u6570\u91cf,x1\u586b\u5145\u7684\u591a\u8fb9\u5f62: P n x1,y1,...\u4e0d\u586b\u5145\u7684\u591a\u8fb9\u5f62: p n x1,y1,...\u4e0d\u95ed\u5408\u7684\u591a\u8fb9\u5f62: L n x1,y1,...\u586b\u5145\u7684\u692d\u5706: E x0 y0 w h((x-x0)/w)\u00b2 + ((y-y0)/h)\u00b2 = 1\u4e0d\u586b\u5145\u7684\u692d\u5706: e x0 y0 w h\u8d1d\u585e\u5c14\u66f2\u7ebf: B n x1,y1,...\u586b\u5145\u7684\u8d1d\u585e\u5c14\u66f2\u7ebf: b n x1,y1,...\u548c\u8bbe\u7f6e\u7c7b\u5c5e\u6027,\u8fd9\u91cc\u7684n\u4ee3\u8868\u51e0\u4f4d\u6bd4\u7279\u4f4d,\u4f8b\u5982 C 7 -#ff0000, n=7\u8868\u793a\u8bfb\u53d6 - \u540e\u9762\u4e03\u4f4d\u4f5c\u4e3a\u989c\u8272\u586b\u5145\u7684\u989c\u8272: C n -b1b2b3(\u53ea\u5bf9\u542f\u7528\u4e86\u586b\u5145\u7684\u56fe\u5f62\u6709\u6548)\u753b\u7b14\u989c\u8272: c n -b1b2b3\u5b57\u4f53: F s n -b1b2b3\u5b57\u4f53\u5927\u5c0f\u7531s\u786e\u5b9a,\u5b57\u4f53\u540d\u5b57\u7531n\u6bd4\u7279(b1b2b3)\u786e\u5b9a\u5b57\u578b: t f, \u5176\u4e2df\u4e3a\u6574\u6570,\u5176\u5bf9\u5e94\u8868\u5982\u4e0b\u4e00\u4e9b\u4f8b\u5b50digraph G {  _background=c 7 -#ff0000 C 7 -#ff0000 b 4 4 4 36 4 36 36 4 36;}\u53c2\u8003Xdot\u6587\u6863\"}","../../../img/search.svg","../../../img/enter.svg","Ctrl+K")</script><script type="text/javascript" src="../../../js/check_box.js"></script>
</body>
</html>