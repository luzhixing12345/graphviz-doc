<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel='stylesheet' href=../../../css/prism.css /><link rel='stylesheet' href=../../../css/index.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">

</head>
<body class="light">
    <div class='markdown-body'><h1>编程环境配置</h1><p>考虑到作为文档的完整性,这里详细讲解一下python和C的graphviz环境搭建</p><h2>Python</h2><p>python已有graphviz的python接口库及<a href="https://graphviz.readthedocs.io/en/stable/manual.html" target="_blank">文档</a></p><pre><code class="language-bash">pip install graphviz</code></pre><h2>C</h2><p>新建文件test.c</p><pre><code class="language-c">#include &lt;graphviz/gvc.h&gt;

char buf[1024];

void readFile(char *fname)
{
    FILE *fp = fopen(fname, "r");
    int p = 0;
    char ch;
    while ((ch = fgetc(fp)) != EOF)
    {
        buf[p++] = ch;
    }
    buf[p] = '\0';
}

int main(int argc, char **argv)
{
    GVC_t *gvc;
    Agraph_t *g;
    gvc = gvContext();
    readFile("ast.dot");
    g = agmemread(buf);
    gvLayout(gvc, g, "dot");
    gvRenderFilename(gvc, g, "png", "out.png");
    gvFreeLayout(gvc, g);
    agclose(g);
    return (gvFreeContext(gvc));
}
</code></pre><p>新建文件ast.dot</p><pre><code class="language-txt">digraph astgraph {
  node [shape=circle, fontsize=12, fontname="Courier", height=.1];
  ranksep=.3;
  edge [arrowsize=.5]
  node1 [label="+"]
  node2 [label="7"]
  node3 [label="*"]
  node4 [label="3"]
  node5 [label="/"]
  node6 [label="10"]
  node7 [label="-"]
  node8 [label="/"]
  node9 [label="12"]
  node10 [label="+"]
  node11 [label="3"]
  node12 [label="1"]
  node10 -&gt; node11
  node10 -&gt; node12
  node8 -&gt; node9
  node8 -&gt; node10
  node13 [label="1"]
  node7 -&gt; node8
  node7 -&gt; node13
  node5 -&gt; node6
  node5 -&gt; node7
  node3 -&gt; node4
  node3 -&gt; node5
  node1 -&gt; node2
  node1 -&gt; node3
}</code></pre><h3>Windows</h3><blockquote>假设graphviz的安装目录为 D:\graphviz, 使用的是vscode(如果是vs或clion应该是有能力解决这个问题的)</blockquote><p>如果是使用C/C++ Extension Pack,点击include报错添加include<i>path,则会出现一个.vscode/c</i>cpp_properties.json,将graphviz的include目录加入includePath即可</p><p>注意windows下路径分隔使用 <code>\\</code> 或 <code>/</code></p><pre><code class="language-json">{
    "configurations": [
        {
            "name": "Win32",
            "includePath": [
                "${workspaceFolder}/**",
                "D:\\graphviz\\include"
            ],
            "defines": [
                "_DEBUG",
                "UNICODE",
                "_UNICODE"
            ],
            "compilerPath": "D:\\mingw64\\bin\\gcc.exe",
            "cStandard": "gnu17",
            "cppStandard": "gnu++14",
            "intelliSenseMode": "windows-gcc-x64"
        }
    ],
    "version": 4
}</code></pre><p>如果是使用的clangd,新建<code>.vscode/settings.json</code>,fallbackFlags中加入include路径即可,后面的clangd.arguments是笔者比较喜欢的clangd配置信息,可加可不加.重启vscode后可以找到头文件和代码补全了</p><pre><code class="language-json">{
    "clangd.fallbackFlags": [
        "-ID:\\graphviz\\include",
    ],
    "clangd.arguments": [
        "--background-index", // 在后台自动分析文件（基于complie_commands)
        "-j=12",  // 同时开启的任务数量
        "--clang-tidy", // clang-tidy功能
        "--clang-tidy-checks=performance-*,bugprone-*",
        "--all-scopes-completion", // 全局补全（会自动补充头文件）
        "--completion-style=detailed", // 更详细的补全内容
        "--header-insertion=iwyu" // 补充头文件的形式
    ]
}</code></pre><p>点击vscode上方 终端->配置任务,然后通过gcc创建 <code>.vscode/task.json</code></p><p>在task.json中修改编译选项</p><pre><code class="language-json">"args": [
    "-fdiagnostics-color=always",
    "-g",
    "${file}",
    "-o",
    "${fileDirname}\\${fileBasenameNoExtension}.exe",
    "-ID:\\graphviz\\include",
    "-LD:\\graphviz\\lib",
    "-lgvc",
    "-lcgraph",
    "-lcdt"
],</code></pre><p>这里声明头文件路径<code>D:\\graphviz\\include</code>,静态链接库的路径<code>D:\\graphviz\\lib</code>,以及三个静态链接库的名字</p><p>编译运行后即可得到<code>output.png</code></p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/out.png" alt="out"></p><h3>GNU/Linux</h3><blockquote>假设使用Ubuntu/Debian系,其他系基本类似</blockquote><p>下载开发版本和包管理pkg-config</p><pre><code class="language-bash">sudo apt install pkg-config graphviz-dev</code></pre><p>此时graphviz头文件的位置为 <code>/usr/include/graphviz</code></p><p>如果是C++ Extension Pack那么已经可以找到graphviz的头文件和代码补全了</p><p>如果是clangd的话类似的加入头文件路径,重启vscode生效</p><pre><code class="language-json">{
    "clangd.fallbackFlags": [
        "-I/usr/include/graphviz",
    ],
    "clangd.arguments": [
        "--background-index", // 在后台自动分析文件（基于complie_commands)
        "-j=12",  // 同时开启的任务数量
        "--clang-tidy", // clang-tidy功能
        "--clang-tidy-checks=performance-*,bugprone-*",
        "--all-scopes-completion", // 全局补全（会自动补充头文件）
        "--completion-style=detailed", // 更详细的补全内容
        "--header-insertion=iwyu" // 补充头文件的形式
    ]
}</code></pre><p>点击vscode上方 终端->配置任务,然后通过gcc创建 <code>.vscode/task.json</code></p><p>在task.json中修改编译选项,这里就不需要指定静态库的位置了.</p><blockquote>除此之外你可以在 <code>/lib/x86_64-linux-gnu/graphviz</code> 下找到其他动态链接库的</blockquote><pre><code class="language-json">"args": [
    "-fdiagnostics-color=always",
    "-g",
    "${file}",
    "-o",
    "${fileDirname}/${fileBasenameNoExtension}",
    "-I/usr/include/graphviz",
    "-lgvc",
    "-lcgraph",
    "-lcdt"
],</code></pre><p>编译运行后即可得到<code>output.png</code></p><p><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/out.png" alt="out"></p><p>如果使用Makefile的话,可以直接借助pkg-config查找相关信息,异曲同工此处便不再赘述</p><pre><code class="language-Makefile">CFLAGS=`pkg-config libgvc --cflags` -Wall -g -O2
# -I/usr/include/graphviz

LDFLAGS=`pkg-config libgvc --libs`
# -lgvc -lcgraph -lcdt

main: main.c
    $(CC) $^ $(CFLAGS) $(LDFLAGS) -o $@</code></pre></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../快速开始/下载" >快速开始<ul><li><a href="../../快速开始/下载" >下载</a></li></ul><ul><li><a href="../../快速开始/编程环境配置" >编程环境配置</a></li></ul></a></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank" >zood</a></div>
    <script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/prism.js"></script><script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../快速开始/下载",".","ab")</script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/search.js"></script><script>addSearchBar("{}","../../../img/search.svg","../../../img/enter.svg","Ctrl+K")</script><script type="text/javascript" src="../../../js/check_box.js"></script>
</body>
</html>